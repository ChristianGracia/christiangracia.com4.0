<div *ngIf="loadingSong" class="flex flex-col justify-center song-loader">
  <div
    class="current-text flex flex-row align-center mat-subheading-1 loading loading-animation"
  >
    <span *ngFor="let char of loadingText">
      {{ char }}
    </span>
  </div>
  <mat-spinner class="spinner" diameter="22" color="accent"></mat-spinner>
</div>

<div
  *ngIf="song && !loadingSong"
  class="flex flex-col justify-center song-container"
>
  <div class="flex flex-row align-center song-row">
    <div class="flex flex-row align-center song-left-col">
      <img
        height="36px"
        width="36px"
        [src]="imagePrefix + song.images[0]"
        alt="{{ song.artist }} album image"
      />
      <div class="flex flex-col justify-center song-info-container">
        <span class="accent-color mat-caption song-name"
          >{{
            song.name.length > 25
              ? song.name.substring(0, 20) + "..."
              : song.name
          }}
        </span>
        <span class="mat-caption song-name">{{ song.artist }}</span>
      </div>
    </div>
    <div class="flex flex-row align-center song-right-col">
      <mat-icon
        class="rewind-button clickable"
        (click)="skipSong('back')"
        color="accent"
        *ngIf="songIndex > 0"
        svgIcon="assets:fast_rewind"
      ></mat-icon>
      <mat-icon
        class="play-button clickable"
        (click)="playPreviewOfSong()"
        color="accent"
        *ngIf="song.previewUrl"
        svgIcon="assets:{{ !songPlaying ? 'play_circle' : 'pause_circle' }}"
      ></mat-icon>
      <mat-icon
        class="forward-button clickable"
        (click)="skipSong('forward')"
        color="accent"
        *ngIf="songIndex !== 1 || songIndex < recentSongs.length - 1"
        svgIcon="assets:fast_forward"
      ></mat-icon>
      <mat-spinner
        *ngIf="songIndex === 1 && recentSongs.length !== 50"
        class="spinner"
        diameter="22"
        color="accent"
      ></mat-spinner>
    </div>
  </div>
  <div class="flex flex-col song-progress-bar-container">
    <mat-progress-bar
      aria-valuemin="00:00"
      aria-valuemax="30:00"
      color="accent"
      class="song-progress-bar"
      mode="determinate"
      value="{{ (songProgress / songDuration) * 100 }}"
    ></mat-progress-bar>
    <div class="flex flex-row song-progress-bar-text-container">
      <p class="song-progress-bar-text">{{ currentTime }}</p>
      <p></p>
      <p class="song-progress-bar-text">{{ endTime }}</p>
    </div>
  </div>
  <div class="current-text flex flex-row align-center mat-display-1">
    <app-lazy-animated-icon></app-lazy-animated-icon>
    <div class="mat-caption" *ngIf="song.playedAt">
      Last played at {{ formatDate(song.playedAt) }}
    </div>
    <ng-template
      class="loading loading-animation"
      ngFor
      let-arr
      [ngForOf]="currentText"
      *ngIf="!song.playedAt"
    >
      <div class="loading loading-animation" style="padding: 2px">
        <span *ngFor="let char of arr">
          {{ char }}
        </span>
      </div>
    </ng-template>
  </div>
</div>
